<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="css/styles.css" />
</head>

<body>
	<div class="container">
		<div class="text-right menu-links">
			<a href="#">Home</a>
			<a href="profile.html">Profile</a>
		</div>
		 <div class="col-lg-8">
                <h1>Task Title</h1>
                <!-- Author -->
                <p class="lead">
                    Posted by <a href="#">author</a>
                </p>
                <p class="lead">
                    Status: 
                </p>

                <p><span class="glyphicon glyphicon-time"></span>Due date: </p>

                <!-- Post Content -->
                <p class="lead">Put Description of the task here!</p>
                

               
                <!-- Posted Comments -->
				<div id="comments">
                <!-- Comment -->
                
				</div>
        
                      
                <!-- Comments Form -->
                <div class="well">
                    <h4>Leave a Comment:</h4>
                    <form role="form">
                        <div class="form-group">
                            <textarea class="form-control" rows="3" id="content"></textarea>
                            <button class="btn btn-default" onClick="leaveComment(); return false;" >Leave comment</button>
                        </div>
                    </form>
                </div>

            </div>
			</div>	
	<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script>
		function leaveComment() {
			 $.ajax({
	              url: '/TaskManager/comment',
	              type: 'POST',
	              data: {"content" : $('#content').val(), "taskId":getParameterByName("id"),"action":"1"},
	              cache: false,
	              dataType: 'json',
	              processData: false,
	              contentType: "application/json",
	              statusCode: {
		        	    200: function(data) {
		        	        console.log(data);
		        	      },
		        	   	403: function() {
		        	   		alert("error with script");
		        	   	}
	         	}
	              
	         });
			
			
			
		}
		
		$(function() {
			var id=getParameterByName("id");
			$.ajax({
	              url: '/TaskManager/comment',
	              type: 'POST',
	              data: JSON.stringify({"action" : "2", "taskId" : id}),
	              contentType: "application/json",
	              dataType: 'json',
	              statusCode: {
		        	    200: function(data) {
		        	    	var commentsDiv=$('#comments');
		        	    	for(var i = 0; i < data.length; i++) {
		        	    	    var obj = data[i];
		        	    	    var mainDiv=$('<div>').addClass('media');
		        	    		var title=$('<h4>').addClass('media-heading').html(obj.userId);
		        	    		var time=$('<small>').html(obj.date);
		        	    		var content=$('<p>').html(obj.content);
		        	    		
		        	    		title.append(time);
		        	    		
		        	    		mainDiv.append(title);
		        	    		mainDiv.append(content);
		        	    		commentsDiv.append(mainDiv);
		        	    	}
		        	      },
		        	   	403: function() {
		        	   		alert("error with script");
		        	   	}
	         	}
			});
		});
		
	</script>
</body>
</html>